<html>
<head>
    <title>FridgeCam</title>
</head>
<body>

    <a href="javascript:void(0)" id="snapButton">
        Take a picture
    </a>

<script src='./browserMqtt.js'></script>
<script>
var full_topic = [username, 'feeds', topic].join('/')

var snapObject = {
	url: 'wss://io.adafruit.com:443/mqtt/',
	fridgecam: 'fridgecam',
	fridgecamsnaps: 'fridgecamsnaps',
	username: '',
	password:''
}

var snapOptions = {
	'keepalive': 60,
	'username': snapObject.username,
	'password': snapObject.password
}
var client = mqtt.connect(url, options)
client.subscribe(full_topic)

client.on('message', function (topic, payload) {
    console.log([topic, payload].join(': '))
    client.end()
})
function takeSnaps() {
	var fridgeCamTopic = [snapObject.username, 'feeds', snapObject.fridgecam].join('/');

	var client = mqtt.connect(snapObject.url, snapOptions);

	client.subscribe(fridgeCamTopic);

	client.on('message', function (fridgeCamTopic, payload) {
	    client.end();
	});

	client.publish(fridgeCamTopic, 'snapnow');
}

window.onload = function() {
	document.getElementById('snapButton').onclick=takeSnaps;
}

client.publish(full_topic, 'snapnow')
</script>
</body>
</html>
